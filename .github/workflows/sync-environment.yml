name: Sync SuperClaude Environment

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  validate-setup:
    runs-on: ubuntu-latest
    name: ç’°å¢ƒè¨­å®šã®æ¤œè¨¼
    
    steps:
      - name: Checkout
        uses: actions/checkout@v3
        
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
          
      - name: å¿…é ˆãƒ•ã‚¡ã‚¤ãƒ«å­˜åœ¨ç¢ºèª
        run: |
          echo "ğŸ” å¿…é ˆãƒ•ã‚¡ã‚¤ãƒ«ã®å­˜åœ¨ã‚’ç¢ºèªä¸­..."
          
          # å¿…é ˆãƒ•ã‚¡ã‚¤ãƒ«ãƒªã‚¹ãƒˆ
          required_files=(
            "é–‹ç™ºç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—.md"
            "ã‚ˆãä½¿ã†ã‚³ãƒãƒ³ãƒ‰.md"
            "README.md"
            "setup.sh"
          )
          
          missing_files=()
          
          for file in "${required_files[@]}"; do
            if [[ -f "$file" ]]; then
              echo "âœ… $file ãŒå­˜åœ¨ã—ã¾ã™"
            else
              echo "âŒ $file ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"
              missing_files+=("$file")
            fi
          done
          
          if [[ ${#missing_files[@]} -gt 0 ]]; then
            echo "::error::å¿…é ˆãƒ•ã‚¡ã‚¤ãƒ«ãŒä¸è¶³ã—ã¦ã„ã¾ã™: ${missing_files[*]}"
            exit 1
          fi
          
          echo "ğŸ‰ å…¨ã¦ã®å¿…é ˆãƒ•ã‚¡ã‚¤ãƒ«ãŒæƒã£ã¦ã„ã¾ã™ï¼"
          
      - name: ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œæ¨©é™ç¢ºèª
        run: |
          if [[ -f "setup.sh" ]]; then
            chmod +x setup.sh
            echo "âœ… setup.sh ã«å®Ÿè¡Œæ¨©é™ã‚’ä»˜ä¸ã—ã¾ã—ãŸ"
          fi
          
      - name: èªè¨¼æƒ…å ±ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç¢ºèª
        run: |
          if [[ -f "èªè¨¼æƒ…å ±ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ.txt" ]]; then
            echo "âœ… èªè¨¼æƒ…å ±ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒå­˜åœ¨ã—ã¾ã™"
            # å®Ÿéš›ã®èªè¨¼æƒ…å ±ãŒå«ã¾ã‚Œã¦ã„ãªã„ã‹ç¢ºèª
            if grep -q "your-actual-token" "èªè¨¼æƒ…å ±ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ.txt" 2>/dev/null; then
              echo "::error::èªè¨¼æƒ…å ±ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã«å®Ÿéš›ã®èªè¨¼æƒ…å ±ãŒå«ã¾ã‚Œã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™"
              exit 1
            fi
          fi
          
      - name: ç’°å¢ƒæ§‹ç¯‰ãƒ†ã‚¹ãƒˆï¼ˆãƒ‰ãƒ©ã‚¤ãƒ©ãƒ³ï¼‰
        run: |
          echo "ğŸ§ª ç’°å¢ƒæ§‹ç¯‰ã®ãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­..."
          
          # Node.js ç’°å¢ƒãƒ†ã‚¹ãƒˆ
          node --version
          npm --version
          
          # Git è¨­å®šãƒ†ã‚¹ãƒˆ
          git --version
          
          echo "âœ… åŸºæœ¬ç’°å¢ƒã¯æ­£å¸¸ã§ã™"
          
  notify-completion:
    runs-on: ubuntu-latest
    needs: validate-setup
    if: success()
    
    steps:
      - name: æˆåŠŸé€šçŸ¥
        run: |
          echo "ğŸ‰ SuperClaudeç’°å¢ƒã®æ¤œè¨¼ãŒå®Œäº†ã—ã¾ã—ãŸï¼"
          echo "ğŸ“‹ ã“ã®ç’°å¢ƒã¯ä»¥ä¸‹ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¾ã™:"
          echo "  - Claude Code v1.0.102+"
          echo "  - SuperClaude Framework"
          echo "  - GitHub Actions çµ±åˆ"
          echo "  - è¤‡æ•°ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ å¯¾å¿œ"